# Stage 7: Cloud Secrets & CI/CD

**Status**: TODO
**Prerequisites**: Debug validation passed (Stage 6)

---

## Overview

Configure GitHub secrets and create the CI/CD workflow for production deployment.

---

## Part A: GitHub Secrets

### Required Secrets

| Secret Name | Source | Set? |
|-------------|--------|------|
| `DIGITALOCEAN_ACCESS_TOKEN` | DO Console → API → Tokens | [ ] |
| `DATABASE_PRIVATE_URL` | Stage 5 connection info | [ ] |
| `KAFKA_PRIVATE_BROKERS` | Stage 5 connection info | [ ] |
| `OPENSEARCH_PRIVATE_URL` | Stage 5 connection info | [ ] |
| `GRADIENT_API_KEY` | DO Console → Serverless → Model Access Keys | [ ] |
| `SPACES_ACCESS_KEY` | DO Console → Spaces → Manage Keys | [ ] |
| `SPACES_SECRET_KEY` | DO Console → Spaces → Manage Keys | [ ] |

### Set Secrets

```bash
# Via GitHub CLI
gh secret set DIGITALOCEAN_ACCESS_TOKEN
gh secret set DATABASE_PRIVATE_URL
gh secret set KAFKA_PRIVATE_BROKERS
gh secret set OPENSEARCH_PRIVATE_URL
gh secret set GRADIENT_API_KEY
gh secret set SPACES_ACCESS_KEY
gh secret set SPACES_SECRET_KEY

# Verify
gh secret list
```

---

## Part B: CI/CD Workflow

### Create Workflow File

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to DigitalOcean App Platform

on:
  push:
    branches: [main]
  workflow_dispatch:

env:
  APP_NAME: {{APP_NAME}}

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to App Platform
        uses: digitalocean/app_action/deploy@v2
        with:
          token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}
          app_name: ${{ env.APP_NAME }}
```

- [ ] Workflow file created
- [ ] Committed to repository

### Configure GitHub Environment (Optional)

For manual approval before production:

1. Go to Repository → Settings → Environments
2. Create "production" environment
3. Enable "Required reviewers"
4. Add reviewers

---

## Verification

```bash
# Check secrets are set
gh secret list

# Expected output:
# DIGITALOCEAN_ACCESS_TOKEN  Updated ...
# DATABASE_PRIVATE_URL       Updated ...
# KAFKA_PRIVATE_BROKERS      Updated ...
# OPENSEARCH_PRIVATE_URL     Updated ...
# GRADIENT_API_KEY           Updated ...
# SPACES_ACCESS_KEY          Updated ...
# SPACES_SECRET_KEY          Updated ...
```

---

## Checklist

- [ ] All secrets configured in GitHub
- [ ] Workflow file created
- [ ] (Optional) GitHub environment configured

---

## Next Steps

Proceed to Stage 8: Cloud Deploy Production
